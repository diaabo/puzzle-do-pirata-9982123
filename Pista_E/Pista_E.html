<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Puzzle 4x4 com Animação</title>
<style>
  body {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: black;
  }
  #puzzle {
    position: relative;
    width: 400px;
    height: 400px;
    background: black;
  }
  .tile {
    position: absolute;
    width: 100px;
    height: 100px;
    background-image: url('Pista_E.jpg');
    background-size: 400px 400px;
    cursor: pointer;
    transition: transform 0.25s;
    border: 1px solid black;
  }
  .empty {
    background: black;
    cursor: default;
  }
</style>
</head>
<body>
<div id="puzzle"></div>

<script>
const size = 4;
const puzzle = document.getElementById('puzzle');
let state = []; // Array com os números 0-15, onde 15 é o vazio
let tiles = [];

function initState() {
  state = [...Array(size*size).keys()];
  shuffleState();
}

function shuffleState() {
  do {
    state.sort(() => Math.random() - 0.5);
  } while (!isSolvable(state));
}

function isSolvable(arr) {
  let inv = 0;
  for (let i = 0; i < arr.length; i++) {
    for (let j = i + 1; j < arr.length; j++) {
      if (arr[i] !== size*size-1 && arr[j] !== size*size-1 && arr[i] > arr[j]) {
        inv++;
      }
    }
  }
  const emptyRowFromBottom = size - Math.floor(arr.indexOf(size*size-1) / size);
  return size % 2 === 1 ? inv % 2 === 0 : (inv + emptyRowFromBottom) % 2 === 0;
}

function createTiles() {
  puzzle.innerHTML = '';
  tiles = [];
  for (let value = 0; value < size*size; value++) {
    const tile = document.createElement('div');
    tile.classList.add('tile');
    if (value === size*size-1) {
      tile.classList.add('empty');
    } else {
      const x = (value % size) * -100;
      const y = Math.floor(value / size) * -100;
      tile.style.backgroundPosition = `${x}px ${y}px`;
      tile.addEventListener('click', () => onTileClick(value));
    }
    tiles.push(tile);
    puzzle.appendChild(tile);
  }
  updatePositions();
}

function updatePositions() {
  state.forEach((value, index) => {
    const tile = tiles[value];
    const row = Math.floor(index / size);
    const col = index % size;
    tile.style.transform = `translate(${col*100}px, ${row*100}px)`;
  });
}

function onTileClick(tileValue) {
  const tileIndex = state.indexOf(tileValue);
  const emptyIndex = state.indexOf(size*size-1);
  if (isNeighbor(tileIndex, emptyIndex)) {
    [state[tileIndex], state[emptyIndex]] = [state[emptyIndex], state[tileIndex]];
    updatePositions();
  }
}

function isNeighbor(i, j) {
  const rowI = Math.floor(i / size), colI = i % size;
  const rowJ = Math.floor(j / size), colJ = j % size;
  return (Math.abs(rowI-rowJ) + Math.abs(colI-colJ)) === 1;
}

initState();
createTiles();
</script>
</body>
</html>
